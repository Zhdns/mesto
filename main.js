(()=>{"use strict";var e={35:(e,t,n)=>{e.exports=n.p+"images/avatar.e39744f3db9e450d6a59.jpg"},464:(e,t,n)=>{e.exports=n.p+"images/deadsea.ad40788ca57bdb49295e.png"},860:(e,t,n)=>{e.exports=n.p+"images/istambul.bebb51cf9863a6534d2f.jpg"},80:(e,t,n)=>{e.exports=n.p+"images/jerusalem.31a5814bc8f1e56f2196.jpg"},438:(e,t,n)=>{e.exports=n.p+"images/moscow.f7636757c5f6033175e0.jpg"},916:(e,t,n)=>{e.exports=n.p+"images/noviVinodolski.ec29079459c644437cfe.jpg"},497:(e,t,n)=>{e.exports=n.p+"images/valencia.b80b2d8c28570776961b.jpg"}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.b=document.baseURI||self.location.href,(()=>{class e{constructor({handleLike:e},{handleDelete:t},n,s,o,i,r){this._card=n,this._element=this._card.template.querySelector(".elements__card").cloneNode(!0),this._photo=this._element.querySelector(".elements__photo"),this._text=this._element.querySelector(".elements__information-name"),this.link=s.link,this.name=s.name,this.likes=s.likes,this.ownerID=s.owner._id,this._cardID=s._id,this.userID=i,this._preview=o,this._api=r,this.handleLike=e,this.handleDelete=t,this._buttonLike=this._element.querySelector(".elements__information-button"),this._buttonDelete=this._element.querySelector(".elements__delete-button"),this._likeAmount=this._element.querySelector(".elements__like-amount")}_openPreviewAddListener(){this._photo.addEventListener("click",(()=>{this._preview(this.link,this.name)}))}_likeAddListener(){this._buttonLike.addEventListener("click",(()=>{this.handleLike()}))}like(){this._buttonLike.classList.contains("elements__information-button_active")?this._api.unlike(this._cardID).then((e=>{this._buttonLike.classList.remove("elements__information-button_active"),this._likeAmount.textContent=e.likes.length})).catch((e=>console.log(e))):this._api.like(this._cardID).then((e=>{this._buttonLike.classList.add("elements__information-button_active"),this._likeAmount.textContent=e.likes.length})).catch((e=>console.log(e)))}_deleteAddListener(){this._buttonDelete.addEventListener("click",(()=>{this.handleDelete()}))}delete(){this._element.closest(".elements__card").remove()}_setEventListeners(){this._likeAddListener(),this._deleteAddListener(),this._openPreviewAddListener()}getElement(){return this._photo.src=this.link,this._photo.alt=this.name,this._text.textContent=this.name,this._likeAmount.textContent=this.likes.length,this._setEventListeners(),this.ownerID!==this.userID&&(this._buttonDelete.style.display="none"),this.likes.find((e=>this.userID===e._id))&&this._buttonLike.classList.add("elements__information-button_active"),this._element}}const t=document.querySelector(".profile"),s=document.querySelector("#close-name-form"),o=document.querySelector("#pop-up__name-input"),i=document.querySelector("#pop-up__profession-input"),r=document.forms.profile,a=document.querySelector("#pop-up-profile-form"),l=document.querySelector(".profile__info-profession"),c=document.querySelector(".profile__info-name"),h=document.querySelector(".profile__avatar"),u=document.querySelector(".profile__info-button"),p=document.querySelector("#pop-up-avatar-form"),d=document.querySelector(".profile__avatar-button"),_=document.forms.avatar,m=document.querySelector(".elements"),f=document.querySelector("#card-template").content,b=document.querySelector("#popUpImg"),v=document.querySelector(".pop-up__img"),g=document.querySelector(".pop-up__text-img"),E=document.querySelector("#previewCloseButton"),y=document.querySelector("#close-card-form"),L=document.querySelector("#cardNameInput"),k=document.querySelector("#cardLinkInput"),S=document.querySelector("#pop-up-card-form"),w=document.querySelector(".profile__add-button"),I=document.forms.card,U=document.querySelector("#pop-up-delete"),x=(new URL(n(464),n.b),new URL(n(860),n.b),new URL(n(80),n.b),new URL(n(438),n.b),new URL(n(916),n.b),new URL(n(497),n.b),{formElement:".pop-up__form-input",inputElement:".pop-up__input-text",inputError:"pop-up__input-text_error",inputTextError:"pop-up__input-error_active",buttonElement:".pop-up__input-button"}),q=(new URL(n(35),n.b),{container:m,template:f,form:I,popUp:S,buttonClose:y,nameInput:L,linkInput:k,buttonAdd:w,confirmWindow:U}),A={popUp:b,buttonClose:E,nameInput:g,photoInput:v},C={container:t,form:r,popUp:a,buttonClose:s,nameInput:o,professionInput:i,name:c,profession:l,avatar:h,buttonEdit:u,avatarPopUp:p,avatarButton:d,avatarForm:_};class R{constructor(e,t){this._config=e,this._form=t,this._button=t.querySelector(this._config.buttonElement),this._inputList=this._form.querySelectorAll(this._config.inputElement)}_setEventListeners(e){const t=e.target;this._checkInputValidity(t),this._toggleButtonState()}_checkInputValidity(e){e.validity.valid?this._hideError(e):(e.classList.add(this._config.inputError),e.nextElementSibling.textContent=e.validationMessage,e.nextElementSibling.classList.add(this._config.inputTextError))}cleanInputs(){this._inputList.forEach((e=>{this._hideError(e)}))}_toggleButtonState(){this._form.checkValidity()?this.activateButton():this.disableButton()}activateButton(){this._button.removeAttribute("disabled")}disableButton(){this._button.setAttribute("disabled",!0)}_hideError(e){e.classList.remove(this._config.inputError),e.nextElementSibling.textContent=" ",e.nextElementSibling.classList.remove(this._config.inputTextError)}enableValidation(){this._form.addEventListener("input",(e=>this._setEventListeners(e)))}}class D{constructor(e){this._popUp=e,this.closeButton=this._popUp.querySelector(".pop-up__close-button")}open(){this._popUp.classList.add("pop-up_open"),document.addEventListener("keydown",this._closeByEscape),this._popUp.addEventListener("mousedown",this._closeOnOverlay)}setEventLisners(){this.closeButton.addEventListener("click",(()=>this.close()))}close(){this._popUp.classList.remove("pop-up_open"),document.removeEventListener("keydown",this._closeByEscape),this._popUp.removeEventListener("mousedown",this._closeOnOverlay)}_closeByEscape=e=>{"Escape"===e.key&&this.close()};_closeOnOverlay=e=>{e.target===this._popUp&&this.close()}}class B extends D{constructor(e,t){super(e),this._form=this._popUp.querySelector(".pop-up__form-input"),this._handleSubmit=t,this._inputList=Array.from(this._form.querySelectorAll(".pop-up__input-text")),this._buttonSubmit=this._form.querySelector(".pop-up__input-button")}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventLisners(){super.setEventLisners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this._getInputValues())}))}close(){super.close(),this._form.reset()}loading(e){this._buttonSubmit.textContent=e?"Сохранение...":"Сохранить"}}const T=new class{constructor(e,t,n){this._name=e,this._job=t,this._avatar=n}getUserInfo(){return this._userInfo={name:this._name.textContent,about:this._job.textContent},this._userInfo}setUserInfo(e){if(!e.name)throw new Error("ERORR NAME");if(this._name.textContent=e.name,!e.about)throw new Error("ERROR ABOUT");if(this._job.textContent=e.about,!e.avatar)throw new Error("ERROR AVATAR");this._avatar.src=e.avatar}}(C.name,C.profession,C.avatar);let j;function O(t){const n=new e({handleLike:()=>{n.like()}},{handleDelete:()=>{W.setCallback((()=>{z.deleteCard(t._id).then((()=>{n.delete(),W.close()})).catch((e=>console.log(e)))})),W.open()}},q,t,N,j,z);return n.getElement()}const V=new class{constructor({render:e},t){this.render=e,this.container=t}addItems(e){this.container.prepend(e)}renderItems(e){e.forEach((e=>{this.render(e)}))}}({render:e=>{const t=O(e);V.addItems(t)}},q.container),P=new class extends D{constructor(e){super(e.popUp),this.preview=e}open(e,t){super.open(),this.preview.photoInput.src=e,this.preview.photoInput.alt=t,this.preview.nameInput.textContent=t}}(A);function N(e,t){P.open(e,t)}const $=new R(x,q.form);$.enableValidation(),q.buttonAdd.addEventListener("click",(()=>{M.open(),$.cleanInputs(),$.disableButton()}));const F=new R(x,C.form);F.enableValidation(),C.buttonEdit.addEventListener("click",(()=>{G.open(),F.cleanInputs(),F.activateButton();const{name:e,about:t}=T.getUserInfo();C.nameInput.value=e,C.professionInput.value=t}));const J=new R(x,C.avatarForm);J.enableValidation(),C.avatarButton.addEventListener("click",(()=>{H.open(),J.cleanInputs(),J.disableButton()}));const G=new B(C.popUp,(e=>{G.loading(!0),z.setUserInfo(e).then((e=>{T.setUserInfo(e),G.close()})).catch((e=>console.log(e))).finally((()=>G.loading(!1)))})),H=new B(C.avatarPopUp,(e=>{console.log(e),H.loading(!0),z.changeAvatar(e).then((e=>{T.setUserInfo(e),H.close()})).catch((e=>console.log(e))).finally((()=>H.loading(!1)))})),M=new B(q.popUp,(e=>{M.loading(!0),z.addCard(e).then((e=>{const t=O(e);V.addItems(t),M.close()})).catch((e=>console.log(e))).finally((()=>M.loading(!1)))}));M.setEventLisners(),G.setEventLisners(),H.setEventLisners(),P.setEventLisners();const W=new class extends D{constructor(e){super(e),this._buttonSubmit=this._popUp.querySelector(".pop-up__input-button")}setCallback(e){this._handleSubmit=e}setEventLisners(){super.setEventLisners(),this._buttonSubmit.addEventListener("click",(e=>{e.preventDefault(),this._handleSubmit()}))}}(q.confirmWindow);W.setEventLisners();const z=new class{constructor(e){this._headers=e.headers,this._baseUrl=e.baseUrl}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getInitialCards(){return fetch(this._baseUrl+"/cards",{method:"GET",headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(this._baseUrl+"/users/me",{method:"GET",headers:this._headers}).then(this._checkResponse)}setUserInfo(e){return fetch(this._baseUrl+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkResponse)}changeAvatar(e){return console.log(e),fetch(this._baseUrl+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then(this._checkResponse)}addCard(e){return fetch(this._baseUrl+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}like(e){return fetch(this._baseUrl+`/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}unlike(e){return fetch(this._baseUrl+`/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}deleteCard(e){return console.log(e),fetch(this._baseUrl+`/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}getData(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-56",headers:{authorization:"a8e6eff0-9937-4599-a4ad-161c65f9e9ed","Content-Type":"application/json"}});z.getData().then((([e,t])=>{T.setUserInfo(t),j=t._id,V.renderItems(e)})).catch((e=>console.log(e)))})()})();